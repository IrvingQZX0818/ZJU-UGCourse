$(function(){$("form#login").submit(function(f){$.ajax({type:"post",url:"login",data:$(this).serialize(),dataType:'json',success:function(g){if(g['success']){$("form#login").fadeOut('normal');e('Login in success! Welecome, '+g['username']+'!'+' Jumping to homepage in 5 seconds...',function(){setTimeout(function(){document.location.href="./"},5000)})}else{e('Error occurs: '+g['error'])}}});f.preventDefault()});$("form#import").submit(function(f){$.ajax({type:"POST",url:"import",data:new FormData(this),cache:false,processData:false,contentType:false,dataType:'json',success:function(g){if(g['success'])e('Successfully import!');else e(g['error'])}});f.preventDefault()});$('input#file').change(function(f){e("Selected file: "+this.files[0].name)});$("form#search").submit(function(f){$.ajax({type:"post",url:"search",data:$(this).serialize(),dataType:'json',success:function(g){if(g['success']){c(g,$('table#searchTable'))}else{e('Error occurs: '+g['error'])}}});f.preventDefault()});$("form#borrow").submit(function(f){$.ajax({type:"post",url:"borrowBook",data:$(this).serialize(),dataType:'json',success:function(g){if(g['status'])e('Successfully Borrowed this book!');if(g['error'])e('Error occurs: '+g['error']);c(g,$('table#returnTable'))}});f.preventDefault()});$("form#return").submit(function(f){$.ajax({type:"post",url:"returnBook",data:$(this).serialize(),dataType:'json',success:function(g){if(g['error'])e('Error occurs: '+g['error']);a(g,$('table#returnTable'))}});f.preventDefault()});function a(f,g){if(f['field'])f['field']['return']='return';for(var h in f['data'])f['data'][h]['return']='<button class="return" bid="'+f['data'][h]['bid']+'" cid="'+f['data'][h]['cid']+'" borrow="'+f['data'][h]['borrow']+'">Return</button>';c(f,g)};function b(f,g){f['field']['delete']='delete';for(var h in f['data'])f['data'][h]['delete']='<button class="deleteCard" cid="'+f['data'][h]['id']+'">Delete</button>';c(f,g)};function c(f,g){g.fadeOut('fast',function(){g.children().remove();g.append('<tr>');$tr=g.children('tr:last');for(var h in f['field'])$tr.append("<th>"+f['field'][h]+"</th>");if(f['data'])for(var i in f['data']){var j="<tr>";for(var k in f['data'][i])j+="<td class='"+k+"'>"+f['data'][i][k]+"</td>";j+="</tr>";g.append(j)};$('th:contains(title)').addClass('inc');g.fadeIn('slow')})};$('table#returnTable').on('click','button.return',function(){var f={bid:$(this).attr('bid'),cid:$(this).attr('cid'),borrow:$(this).attr('borrow')};$.ajax({type:"post",url:"returnBook",data:f,dataType:'json',success:function(g){if(g['status'])e('Successfully returned this book!');if(g['error'])e('Error occurs: '+g['error']);a(g,$('table#returnTable'))}})});$('table#cardTable').on('click','button.deleteCard',function(){var f={id:$(this).attr('cid')};$.ajax({type:"post",url:"card",data:f,dataType:'json',success:function(g){if(g['status'])e('Successfully deleted this card!');if(g['error'])e('Error occurs: '+g['error']);b(g,$('table#cardTable'))}})});$('form#newCard').submit(function(f){$.ajax({type:"post",url:"card",data:$(this).serialize(),dataType:'json',success:function(g){if(g['status'])e('Successfully add this card!');if(g['error'])e('Error occurs: '+g['error']);b(g,$('table#cardTable'))}});this.reset();f.preventDefault()});$('form#addBook').submit(function(f){$.ajax({type:"post",url:"import",data:$(this).serialize(),dataType:'json',success:function(g){if(g['success'])e('Successfully add this book!');else e('Error occurs: '+g['error'])}});this.reset();f.preventDefault()});function d(f,g){if(isNaN(f)||isNaN(g))return f.localeCompare(g);else return f-g};$('table').on('click','th',function(f){var g=$(this).index();var h=$(this).hasClass('inc');$(this).parent().children().removeClass('dec').removeClass('inc');$(this).addClass(h?'dec':'inc');var i=$(this).parents('table');var j=i.find('tr:not(:has(th))');var k=j.get().sort(function(l,m){var n=$(l).children().eq(g).text();var o=$(m).children().eq(g).text();return h?-d(n,o):d(n,o)});j.remove();i.append(k)});function e(f,g){$('#tip').hide('normal',function(){$('#tip span').text(f);$('#tip').show('show',g)})}});
